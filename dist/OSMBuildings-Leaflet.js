!function(a){"use strict";function b(a,b){var c=a[0]-b[0],d=a[1]-b[1];return c*c+d*d}function c(a){var c=a.length;if(c<8)return!1;var e=d(a),f=e.max[0]-e.min[0],g=e.max[1]-e.min[1],h=f/g;if(h<.85||h>1.15)return!1;for(var i,j=[e.min[0]+f/2,e.min[1]+g/2],k=(f+g)/4,l=k*k,m=0;m<c;m++)if(i=b(a[m],j),i/l<.8||i/l>1.2)return!1;return!0}function d(a){var b=1/0,c=-(1/0),d=1/0,e=-(1/0);return a.forEach(function(a){b=Math.min(b,a[0]),c=Math.max(c,a[0]),d=Math.min(d,a[1]),e=Math.max(e,a[1])}),{min:[b,d],max:[c,e]}}function e(a){var b=d(a);return[b.min[0]+(b.max[0]-b.min[0])/2,b.min[1]+(b.max[1]-b.min[1])/2]}function f(a){var b=180,c=-180;return a.forEach(function(a){b=Math.min(b,a[0]),c=Math.max(c,a[0])}),c-b}function g(a){return a/U*180}function h(a,b){return a/=I,b/=I,{lon:360*(1===a?1:(a%1+1)%1)-180,lat:b<=0?90:b>=1?-90:g(2*Math.atan(Math.exp(U*(1-2*b)))-V)}}function i(a,b){var c=Math.min(1,Math.max(0,.5-Math.log(Math.tan(W+V*b/180))/Math.PI/2)),d=a/360+.5;return[d*I<<0,c*I<<0]}function j(a){for(var b=Z+ba,c=$+ca,d=0;d<a.length;d++)if(a[d][0]>ba&&a[d][0]<b&&a[d][1]>ca&&a[d][1]<c)return!0;return!1}function k(a,b){var c=new XMLHttpRequest;return c.onreadystatechange=function(){if(4===c.readyState&&!(!c.status||c.status<200||c.status>299)&&b&&c.responseText){var a;try{a=JSON.parse(c.responseText)}catch(d){}b(a)}},c.open("GET",a),c.send(null),c}function l(){O||(O=setInterval(function(){for(var a=ma.items,b=!1,c=0,d=a.length;c<d;c++)a[c].scale<1&&(a[c].scale+=.1,a[c].scale>1&&(a[c].scale=1),b=!0);qa.render(),b||(clearInterval(O),O=null)},33))}function m(a){ba=a.x,ca=a.y}function n(a,b){K=_+a,M=$+b,qa.render(!0)}function o(a){Z=a.width,$=a.height,_=Z/2<<0,aa=$/2<<0,K=_,M=$,qa.setSize(Z,$),J=la-50}function p(a){H=a,I=X<<H;var b=h(ba+_,ca+aa),c=i(0,b.lat),d=i(1,b.lat);ja=d[0]-c[0],qa.setOpacity(Math.pow(.95,H-Y)),ga=""+da,ha=""+ea,ia=""+fa}function q(a){qa.render(),ma.update()}function r(){N=!0}function s(a){N=!1;var b=Math.pow(2,a.zoom-H);return p(a.zoom),H<=Y?void qa.clear():(ma.scale(b),ta.render(),sa.render(),ra.render(),void ma.update())}var t=Math,u=(t.exp,t.log,t.sin,t.cos,t.tan),v=(t.atan,t.atan2),w=t.min,x=t.max,y=t.sqrt,z=t.ceil,A=(t.floor,t.round,t.pow),B=B||Array,C=C||Array,D=/iP(ad|hone|od)/g.test(navigator.userAgent),E=!!~navigator.userAgent.indexOf("Trident"),F=!a.requestAnimationFrame||D||E?function(a){a()}:a.requestAnimationFrame,G=function(){function a(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}function b(a,b){if(void 0!==a)return Math.min(b,Math.max(0,a||0))}var c={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},d=function(a,c,d,e){this.r=b(a,1),this.g=b(c,1),this.b=b(d,1),this.a=b(e,1)||1};return d.parse=function(a){if("string"==typeof a){a=a.toLowerCase(),a=c[a]||a;var b;if(b=a.match(/^#?(\w{2})(\w{2})(\w{2})$/))return new d(parseInt(b[1],16)/255,parseInt(b[2],16)/255,parseInt(b[3],16)/255);if(b=a.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new d(parseFloat(b[1])/255,parseFloat(b[2])/255,parseFloat(b[3])/255,b[4]?parseFloat(b[5]):1)}return new d},d.fromHSL=function(b,c,e,f){if(0===c)return new d(e,e,e,f);var g=e<.5?e*(1+c):e+c-e*c,h=2*e-g;return b/=360,new d(a(h,g,b+1/3),a(h,g,b),a(h,g,b-1/3),f)},d.prototype={toHSL:function(){if(void 0!==this.r&&void 0!==this.g&&void 0!==this.b){var a,b,c=Math.max(this.r,this.g,this.b),d=Math.min(this.r,this.g,this.b),e=(c+d)/2,f=c-d;if(f){switch(b=e>.5?f/(2-c-d):f/(c+d),c){case this.r:a=(this.g-this.b)/f+(this.g<this.b?6:0);break;case this.g:a=(this.b-this.r)/f+2;break;case this.b:a=(this.r-this.g)/f+4}a*=60}else a=b=0;return{h:a,s:b,l:e,a:this.a}}},toString:function(){if(void 0!==this.r&&void 0!==this.g&&void 0!==this.b)return 1===this.a?"#"+((1<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)).toString(16).slice(1,7):"rgba("+[Math.round(255*this.r),Math.round(255*this.g),Math.round(255*this.b),this.a.toFixed(2)].join(",")+")"},toArray:function(){if(void 0!==this.r&&void 0!==this.g&&void 0!==this.b)return[this.r,this.g,this.b]},hue:function(a){var b=this.toHSL();return d.fromHSL(b.h+a,b.s,b.l)},saturation:function(a){var b=this.toHSL();return d.fromHSL(b.h,b.s*a,b.l)},lightness:function(a){var b=this.toHSL();return d.fromHSL(b.h,b.s,b.l*a)},red:function(a){return new d(this.r*a,this.g,this.b,this.a)},green:function(a){return new d(this.r,this.g*a,this.b,this.a)},blue:function(a){return new d(this.r,this.g,this.b*a,this.a)},alpha:function(a){return new d(this.r,this.g,this.b,this.a*a)},copy:function(){return new d(this.r,this.g,this.b,this.a)}},d}();"object"==typeof module&&(module.exports=G);var H,I,J,K,M,N,O,P=function(){function a(a){return a.valueOf()/s-.5+t}function b(b){return a(b)-u}function c(a,b){return q(m(a)*n(v)-o(b)*m(v),n(a))}function d(a,b){return p(m(b)*n(v)+n(b)*m(v)*m(a))}function e(a,b,c){return q(m(a),n(a)*m(b)-o(c)*n(b))}function f(a,b,c){return p(m(b)*m(c)+n(b)*n(c)*n(a))}function g(a,b){return r*(280.16+360.9856235*a)-b}function h(a){return r*(357.5291+.98560028*a)}function i(a){return r*(1.9148*m(a)+.02*m(2*a)+3e-4*m(3*a))}function j(a,b){var c=102.9372*r;return a+b+c+l}var k=Math,l=k.PI,m=k.sin,n=k.cos,o=k.tan,p=k.asin,q=k.atan2,r=l/180,s=864e5,t=2440588,u=2451545,v=23.4397*r;return function(a,k,m){var n=r*-m,o=r*k,p=b(a),q=h(p),s=i(q),t=j(q,s),u=d(t,0),v=c(t,0),w=g(p,n),x=w-v;return{altitude:f(x,o,u),azimuth:e(x,o,u)-l/2}}}(),Q=function(){function a(a){return a=a.toLowerCase(),"#"===a[0]?a:h[i[a]||a]||null}function b(a){return 0<a.reduce(function(a,b,c,d){return a+(c<d.length-1?(d[c+1][0]-b[0])*(d[c+1][1]+b[1]):0)},0)}function c(b){var c={};b=b||{},c.height=b.height||(b.levels?b.levels*g:ka),c.minHeight=b.minHeight||(b.minLevel?b.minLevel*g:0);var d=b.material?a(b.material):b.wallColor||b.color;d&&(c.wallColor=d);var e=b.roofMaterial?a(b.roofMaterial):b.roofColor;switch(e&&(c.roofColor=e),b.shape){case"cylinder":case"cone":case"dome":case"sphere":c.shape=b.shape,c.isRotational=!0;break;case"pyramid":c.shape=b.shape}switch(b.roofShape){case"cone":case"dome":c.roofShape=b.roofShape,c.isRotational=!0;break;case"pyramid":c.roofShape=b.roofShape}return c.roofShape&&b.roofHeight?(c.roofHeight=b.roofHeight,c.height=x(0,c.height-c.roofHeight)):c.roofHeight=0,c}function d(a){var c,e,f,g=[];switch(a.type){case"GeometryCollection":for(g=[],c=0,e=a.geometries.length;c<e;c++)(f=d(a.geometries[c]))&&g.push.apply(g,f);return g;case"MultiPolygon":for(g=[],c=0,e=a.coordinates.length;c<e;c++)(f=d({type:"Polygon",coordinates:a.coordinates[c]}))&&g.push.apply(g,f);return g;case"Polygon":var h=a.coordinates.map(function(a,c){return 0===c!==b(a)&&a.reverse(),a});return[h]}return[]}function e(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var g=3,h={brick:"#cc7755",bronze:"#ffeecc",canvas:"#fff8f0",concrete:"#999999",copper:"#a0e0d0",glass:"#e8f8f8",gold:"#ffcc00",plants:"#009933",metal:"#aaaaaa",panel:"#fff8f0",plaster:"#999999",roof_tiles:"#f08060",silver:"#cccccc",slate:"#666666",stone:"#996666",tar_paper:"#333333",wood:"#deb887"},i={asphalt:"tar_paper",bitumen:"tar_paper",block:"stone",bricks:"brick",glas:"glass",glassfront:"glass",grass:"plants",masonry:"stone",granite:"stone",panels:"panel",paving_stones:"stone",plastered:"plaster",rooftiles:"roof_tiles",roofingfelt:"tar_paper",sandstone:"stone",sheet:"canvas",sheets:"canvas",shingle:"tar_paper",shingles:"tar_paper",slates:"slate",steel:"metal",tar:"tar_paper",tent:"canvas",thatch:"plants",tile:"roof_tiles",tiles:"roof_tiles"};return{read:function(a){if(!a||"FeatureCollection"!==a.type)return[];var b,g,h,i,j,k,l,m,n=a.features,o=[];for(b=0,g=n.length;b<g;b++)if(j=n[b],"Feature"===j.type&&xa(j)!==!1)for(l=c(j.properties),k=d(j.geometry),h=0,i=k.length;h<i;h++)m=e(l),m.geometry=k[h],m.isRotational&&(m.radius=f(m.geometry[0])/2),(j.id||j.properties.id)&&(m.id=j.id||j.properties.id),j.properties.relationId&&(m.relationId=j.properties.relationId),o.push(m);return o}}}(),R="0.2.3b",S='&copy; <a href="https://osmbuildings.org">OSM Buildings</a>',T="https://{s}.data.osmbuildings.org/0.2/{k}/tile/{z}/{x}/{y}.json",U=Math.PI,V=U/2,W=U/4,X=256,Y=15,Z=0,$=0,_=0,aa=0,ba=0,ca=0,da=G.parse("rgba(200, 190, 180)"),ea=da.lightness(.8),fa=da.lightness(1.2),ga=""+da,ha=""+ea,ia=""+fa,ja=0,ka=5,la=450,ma={loadedItems:{},items:[],projectGeometry:function(a){return a.map(function(a){return a.map(function(a){return i(a[0],a[1])})})},resetItems:function(){this.items=[],this.loadedItems={},ua.reset()},addRenderItems:function(a,b){for(var c,d,e,f=Q.read(a),g=0,h=f.length;g<h;g++)c=f[g],e=c.id||[c.geometry[0][0],c.geometry[0][1],c.height,c.minHeight].join(","),this.loadedItems[e]||(d=this.scaleItem(c))&&(d.scale=b?0:1,this.items.push(d),this.loadedItems[e]=1);l()},scaleGeometry:function(a,b){return a.map(function(a){return a.map(function(a){return[a[0]*b,a[1]*b]})})},scale:function(a){ma.items=ma.items.map(function(b){return b.height*=a,b.minHeight*=a,b.geometry=ma.scaleGeometry(b.geometry,a),b.center[0]*=a,b.center[1]*=a,b.radius&&(b.radius*=a),b.roofHeight*=a,b})},scaleItem:function(a){var b={},d=6/A(2,H-Y);if(a.id&&(b.id=a.id),b.height=w(a.height/d,J),b.minHeight=isNaN(a.minHeight)?0:a.minHeight/d,!(b.minHeight>J||(b.geometry=ma.projectGeometry(a.geometry),b.geometry[0].length<4))){b.center=e(b.geometry[0]),a.radius&&(b.radius=a.radius*ja),a.shape&&(b.shape=a.shape),a.roofShape&&(b.roofShape=a.roofShape),"cone"!==b.roofShape&&"dome"!==b.roofShape||b.shape||!c(b.geometry[0])||(b.shape="cylinder");var f;if(a.wallColor&&(f=G.parse(a.wallColor))&&(b.altColor=""+f.lightness(.8),b.wallColor=""+f),a.roofColor&&(f=G.parse(a.roofColor))&&(b.roofColor=""+f),a.relationId&&(b.relationId=a.relationId),b.hitColor=ua.idToColor(a.relationId||a.id),b.roofHeight=isNaN(a.roofHeight)?0:a.roofHeight/d,!(b.height+b.roofHeight<=b.minHeight))return b}},set:function(a){this.isStatic=!0,this.resetItems(),this._staticData=a,this.addRenderItems(this._staticData,!0)},load:function(a,b){this.src=a||T.replace("{k}",b||"anonymous"),this.update()},update:function(){function a(a){k.addRenderItems(a)}if(this.resetItems(),!(H<Y)){if(this.isStatic&&this._staticData)return void this.addRenderItems(this._staticData);if(this.src){var b,c,d=16,e=256,f=H>d?e<<H-d:e>>d-H,g=ba/f<<0,h=ca/f<<0,i=z((ba+Z)/f),j=z((ca+$)/f),k=this;for(c=h;c<=j;c++)for(b=g;b<=i;b++)this.loadTile(b,c,d,a)}}},loadTile:function(a,b,c,d){var e="abcd"[(a+b)%4],f=this.src.replace("{s}",e).replace("{x}",a).replace("{y}",b).replace("{z}",c);return k(f,d)}},na={draw:function(a,b,c,d,e,f,g){var h=b.map(function(b){return na._extrude(a,b,c,d,e,f)});a.fillStyle=g,a.beginPath(),h.forEach(function(b){na._ring(a,b)}),a.closePath(),a.fill()},_extrude:function(a,b,c,d,e,f){for(var g,h,i=la/(la-c),j=la/(la-d),k=[0,0],l=[0,0],m=[],n=0;n<b.length-1;n++)k[0]=b[n][0]-ba,k[1]=b[n][1]-ca,l[0]=b[n+1][0]-ba,l[1]=b[n+1][1]-ca,g=ra.project(k,i),h=ra.project(l,i),d&&(k=ra.project(k,j),l=ra.project(l,j)),(l[0]-k[0])*(g[1]-k[1])>(g[0]-k[0])*(l[1]-k[1])&&(k[0]<l[0]&&k[1]<l[1]||k[0]>l[0]&&k[1]>l[1]?a.fillStyle=f:a.fillStyle=e,a.beginPath(),this._ring(a,[l,k,g,h]),a.closePath(),a.fill()),m[n]=g;return m},_ring:function(a,b){a.moveTo(b[0][0],b[0][1]);for(var c=1;c<b.length;c++)a.lineTo(b[c][0],b[c][1])},simplified:function(a,b){a.beginPath(),b.forEach(function(b){na._ringAbs(a,b)}),a.closePath(),a.fill()},_ringAbs:function(a,b){a.moveTo(b[0][0]-ba,b[0][1]-ca);for(var c=1;c<b.length;c++)a.lineTo(b[c][0]-ba,b[c][1]-ca)},shadow:function(a,b,c,d){for(var e,f,g=null,h=[0,0],i=[0,0],j=0;j<b[0].length-1;j++)h[0]=b[0][j][0]-ba,h[1]=b[0][j][1]-ca,i[0]=b[0][j+1][0]-ba,i[1]=b[0][j+1][1]-ca,e=ta.project(h,c),f=ta.project(i,c),d&&(h=ta.project(h,d),i=ta.project(i,d)),(i[0]-h[0])*(e[1]-h[1])>(e[0]-h[0])*(i[1]-h[1])?(1===g&&a.lineTo(h[0],h[1]),g=0,j||a.moveTo(h[0],h[1]),a.lineTo(i[0],i[1])):(0===g&&a.lineTo(e[0],e[1]),g=1,j||a.moveTo(e[0],e[1]),a.lineTo(f[0],f[1]));if(b.length>1)for(j=1;j<b.length;j++)this._ringAbs(a,b[j])},hitArea:function(a,b,c,d,e){var f,g,h=null,i=[0,0],j=[0,0],k=la/(la-c),l=la/(la-d);a.fillStyle=e,a.beginPath();for(var m=0;m<b[0].length-1;m++)i[0]=b[0][m][0]-ba,i[1]=b[0][m][1]-ca,j[0]=b[0][m+1][0]-ba,j[1]=b[0][m+1][1]-ca,f=ra.project(i,k),g=ra.project(j,k),d&&(i=ra.project(i,l),j=ra.project(j,l)),(j[0]-i[0])*(f[1]-i[1])>(f[0]-i[0])*(j[1]-i[1])?(1===h&&a.lineTo(i[0],i[1]),h=0,m||a.moveTo(i[0],i[1]),a.lineTo(j[0],j[1])):(0===h&&a.lineTo(f[0],f[1]),h=1,m||a.moveTo(f[0],f[1]),a.lineTo(g[0],g[1]));a.closePath(),a.fill()}},oa={draw:function(a,b,c,d,e,f,g,h,i){var j,k,l=[b[0]-ba,b[1]-ca],m=la/(la-e),n=la/(la-f),o=ra.project(l,m);d*=m,f&&(l=ra.project(l,n),c*=n);var p=this._tangents(l,c,o,d);p?(j=Math.atan2(p[0][0][1]-l[1],p[0][0][0]-l[0]),k=Math.atan2(p[1][0][1]-l[1],p[1][0][0]-l[0])):(j=1.5*U,k=1.5*U),a.fillStyle=g,a.beginPath(),a.arc(o[0],o[1],d,V,j,!0),a.arc(l[0],l[1],c,j,V),a.closePath(),a.fill(),a.fillStyle=h,a.beginPath(),a.arc(o[0],o[1],d,k,V,!0),a.arc(l[0],l[1],c,V,k),a.closePath(),a.fill(),a.fillStyle=i,this._circle(a,o,d)},simplified:function(a,b,c){this._circle(a,[b[0]-ba,b[1]-ca],c)},shadow:function(a,b,c,d,e,f){var g,h,i=[b[0]-ba,b[1]-ca],j=ta.project(i,e);f&&(i=ta.project(i,f));var k=this._tangents(i,c,j,d);k?(g=v(k[0][0][1]-i[1],k[0][0][0]-i[0]),h=v(k[1][0][1]-i[1],k[1][0][0]-i[0]),a.moveTo(k[1][1][0],k[1][1][1]),a.arc(j[0],j[1],d,h,g),a.arc(i[0],i[1],c,g,h)):(a.moveTo(i[0]+c,i[1]),a.arc(i[0],i[1],c,0,2*U))},hitArea:function(a,b,c,d,e,f,g){var h,i,j=[b[0]-ba,b[1]-ca],k=la/(la-e),l=la/(la-f),m=ra.project(j,k);d*=k,f&&(j=ra.project(j,l),c*=l);var n=this._tangents(j,c,m,d);a.fillStyle=g,a.beginPath(),n?(h=v(n[0][0][1]-j[1],n[0][0][0]-j[0]),i=v(n[1][0][1]-j[1],n[1][0][0]-j[0]),a.moveTo(n[1][1][0],n[1][1][1]),a.arc(m[0],m[1],d,i,h),a.arc(j[0],j[1],c,h,i)):(a.moveTo(j[0]+c,j[1]),a.arc(j[0],j[1],c,0,2*U)),a.closePath(),a.fill()},_circle:function(a,b,c){a.beginPath(),a.arc(b[0],b[1],c,0,2*U),a.fill()},_tangents:function(a,b,c,d){var e=a[0]-c[0],f=a[1]-c[1],g=b-d,h=e*e+f*f;if(!(h<=g*g)){var i,j,k,l=y(h),m=-e/l,n=-f/l,o=g/l,p=[];i=y(x(0,1-o*o));for(var q=1;q>=-1;q-=2)j=m*o-q*i*n,k=n*o+q*i*m,p.push([[a[0]+b*j<<0,a[1]+b*k<<0],[c[0]+d*j<<0,c[1]+d*k<<0]]);return p}}},pa={draw:function(a,b,c,d,e,f,g){for(var h=[c[0]-ba,c[1]-ca],i=la/(la-d),j=la/(la-e),k=ra.project(h,i),l=[0,0],m=[0,0],n=0;n<b.length-1;n++)l[0]=b[n][0]-ba,l[1]=b[n][1]-ca,m[0]=b[n+1][0]-ba,m[1]=b[n+1][1]-ca,e&&(l=ra.project(l,j),m=ra.project(m,j)),(m[0]-l[0])*(k[1]-l[1])>(k[0]-l[0])*(m[1]-l[1])&&(l[0]<m[0]&&l[1]<m[1]||l[0]>m[0]&&l[1]>m[1]?a.fillStyle=g:a.fillStyle=f,a.beginPath(),this._triangle(a,l,m,k),a.closePath(),a.fill())},_triangle:function(a,b,c,d){a.moveTo(b[0],b[1]),a.lineTo(c[0],c[1]),a.lineTo(d[0],d[1])},_ring:function(a,b){a.moveTo(b[0][0]-ba,b[0][1]-ca);for(var c=2;c<b.length;c++)a.lineTo(b[c][0]-ba,b[c][1]-ca)},shadow:function(a,b,c,d,e){for(var f=[0,0],g=[0,0],h=[c[0]-ba,c[1]-ca],i=ta.project(h,d),j=0;j<b.length-1;j++)f[0]=b[j][0]-ba,f[1]=b[j][1]-ca,g[0]=b[j+1][0]-ba,g[1]=b[j+1][1]-ca,e&&(f=ta.project(f,e),g=ta.project(g,e)),(g[0]-f[0])*(i[1]-f[1])>(i[0]-f[0])*(g[1]-f[1])&&this._triangle(a,f,g,i)},hitArea:function(a,b,c,d,e,f){var g=[c[0]-ba,c[1]-ca],h=la/(la-d),i=la/(la-e),j=ra.project(g,h),k=[0,0],l=[0,0];a.fillStyle=f,a.beginPath();for(var m=0;m<b.length-1;m++)k[0]=b[m][0]-ba,k[1]=b[m][1]-ca,l[0]=b[m+1][0]-ba,l[1]=b[m+1][1]-ca,e&&(k=ra.project(k,i),l=ra.project(l,i)),(l[0]-k[0])*(j[1]-k[1])>(j[0]-k[0])*(l[1]-k[1])&&this._triangle(a,k,l,j);a.closePath(),a.fill()}},qa={container:document.createElement("DIV"),items:[],init:function(){qa.container.className="osmb-container",ta.init(qa.createContext(qa.container)),sa.init(qa.createContext(qa.container)),ra.init(qa.createContext(qa.container)),ua.init(qa.createContext())},clear:function(){ta.clear(),sa.clear(),ra.clear(),ua.clear()},setOpacity:function(a){ta.setOpacity(a),sa.setOpacity(a),ra.setOpacity(a),ua.setOpacity(a)},render:function(a){return H<Y?void qa.clear():void(N||F(function(){a||(ta.render(),sa.render()),ra.render()}))},createContext:function(a){var b=document.createElement("CANVAS");b.className="osmb-layer";var c=b.getContext("2d");return c.lineCap="round",c.lineJoin="round",c.lineWidth=1,c.imageSmoothingEnabled=!1,qa.items.push(b),a&&a.appendChild(b),c},appendTo:function(a){a.appendChild(qa.container)},remove:function(){qa.container.parentNode.removeChild(qa.container)},setSize:function(a,b){qa.items.forEach(function(c){c.width=a,c.height=b})},setPosition:function(a,b){qa.container.style.left=a+"px",qa.container.style.top=b+"px"}},ra={context:null,init:function(a){this.context=a},clear:function(){this.context.clearRect(0,0,Z,$)},setOpacity:function(a){this.context.canvas.style.opacity=a},project:function(a,b){return[(a[0]-K)*b+K<<0,(a[1]-M)*b+M<<0]},render:function(){this.clear();var a,c,d,e,f,g,h=this.context,i=[K+ba,M+ca],k=ma.items;k.sort(function(a,c){return a.minHeight-c.minHeight||b(c.center,i)-b(a.center,i)||c.height-a.height});for(var l=0,m=k.length;l<m;l++)if(a=k[l],!sa.isSimple(a)&&j(a.geometry[0])){switch(c=a.scale<1?a.height*a.scale:a.height,d=0,a.minHeight&&(d=a.scale<1?a.minHeight*a.scale:a.minHeight),e=a.wallColor||ga,f=a.altColor||ha,g=a.roofColor||ia,h.strokeStyle=f,a.shape){case"cylinder":oa.draw(h,a.center,a.radius,a.radius,c,d,e,f,g);break;case"cone":oa.draw(h,a.center,a.radius,0,c,d,e,f);break;case"dome":oa.draw(h,a.center,a.radius,a.radius/2,c,d,e,f);break;case"sphere":oa.draw(h,a.center,a.radius,a.radius,c,d,e,f,g);break;case"pyramid":pa.draw(h,a.geometry,a.center,c,d,e,f);break;default:na.draw(h,a.geometry,c,d,e,f,g)}switch(a.roofShape){case"cone":oa.draw(h,a.center,a.radius,0,c+a.roofHeight,c,g,""+G.parse(g).lightness(.9));break;case"dome":oa.draw(h,a.center,a.radius,a.radius/2,c+a.roofHeight,c,g,""+G.parse(g).lightness(.9));break;case"pyramid":pa.draw(h,a.geometry,a.center,c+a.roofHeight,c,g,G.parse(g).lightness(.9))}}}},sa={context:null,MAX_ZOOM:16,MAX_HEIGHT:5,init:function(a){this.context=a},clear:function(){this.context.clearRect(0,0,Z,$)},setOpacity:function(a){this.context.canvas.style.opacity=a},isSimple:function(a){return H<=sa.MAX_ZOOM&&a.height+a.roofHeight<sa.MAX_HEIGHT},render:function(){this.clear();var a=this.context;if(!(H>sa.MAX_ZOOM))for(var b,c=ma.items,d=0,e=c.length;d<e;d++)if(b=c[d],!(b.height>=sa.MAX_HEIGHT)&&j(b.geometry[0]))switch(a.strokeStyle=b.altColor||ha,a.fillStyle=b.roofColor||ia,b.shape){case"cylinder":case"cone":case"dome":case"sphere":oa.simplified(a,b.center,b.radius);break;default:na.simplified(a,b.geometry)}}},ta={context:null,color:"#666666",blurColor:"#000000",date:new Date,direction:[0,0],opacity:1,init:function(a){this.context=a},clear:function(){this.context.clearRect(0,0,Z,$)},setOpacity:function(a){this.opacity=a},project:function(a,b){return[a[0]+ta.direction[0]*b,a[1]+ta.direction[1]*b]},render:function(){this.clear();var a,b,c,d,e=ta.context;if(a=h(_+ba,aa+ca),b=P(ta.date,a.lat,a.lon),!(b.altitude<=0)){c=1/u(b.altitude),d=c<5?.75:1/c*5,ta.direction=[Math.cos(b.azimuth)*c,Math.sin(b.azimuth)*c];var f,g,i,k=ma.items;e.canvas.style.opacity=d/(2*ta.opacity),e.shadowColor=ta.blurColor,e.fillStyle=ta.color,e.beginPath();for(var l=0;l<k.length;l++)if(f=k[l],j(f.geometry[0])){switch(g=f.scale<1?f.height*f.scale:f.height,i=0,f.minHeight&&(i=f.scale<1?f.minHeight*f.scale:f.minHeight),f.shape){case"cylinder":oa.shadow(e,f.center,f.radius,f.radius,g,i);break;case"cone":oa.shadow(e,f.center,f.radius,0,g,i);break;case"dome":oa.shadow(e,f.center,f.radius,f.radius/2,g,i);break;case"sphere":oa.shadow(e,f.center,f.radius,f.radius,g,i);break;case"pyramid":pa.shadow(e,f.geometry,f.center,g,i);break;default:na.shadow(e,f.geometry,g,i)}switch(f.roofShape){case"cone":oa.shadow(e,f.center,f.radius,0,g+f.roofHeight,g);break;case"dome":oa.shadow(e,f.center,f.radius,f.radius/2,g+f.roofHeight,g);break;case"pyramid":pa.shadow(e,f.geometry,f.center,g+f.roofHeight,g)}}e.closePath(),e.fill()}}},ua={context:null,init:function(a){this.context=a},setOpacity:function(a){},clear:function(){},_idMapping:[null],reset:function(){this._idMapping=[null]},render:function(){if(!this._timer){var a=this;this._timer=setTimeout(function(){a._timer=null,a._render()},500)}},_render:function(){this.clear();var a,c,d,e,f=this.context,g=[K+ba,M+ca],h=ma.items;h.sort(function(a,c){return a.minHeight-c.minHeight||b(c.center,g)-b(a.center,g)||c.height-a.height});for(var i=0,k=h.length;i<k;i++)if(a=h[i],(e=a.hitColor)&&j(a.geometry[0])){switch(c=a.height,d=0,a.minHeight&&(d=a.minHeight),a.shape){case"cylinder":oa.hitArea(f,a.center,a.radius,a.radius,c,d,e);break;case"cone":oa.hitArea(f,a.center,a.radius,0,c,d,e);break;case"dome":oa.hitArea(f,a.center,a.radius,a.radius/2,c,d,e);break;case"sphere":oa.hitArea(f,a.center,a.radius,a.radius,c,d,e);break;case"pyramid":pa.hitArea(f,a.geometry,a.center,c,d,e);break;default:na.hitArea(f,a.geometry,c,d,e)}switch(a.roofShape){case"cone":oa.hitArea(f,a.center,a.radius,0,c+a.roofHeight,c,e);break;case"dome":oa.hitArea(f,a.center,a.radius,a.radius/2,c+a.roofHeight,c,e);break;case"pyramid":pa.hitArea(f,a.geometry,a.center,c+a.roofHeight,c,e)}}Z&&$&&(this._imageData=this.context.getImageData(0,0,Z,$).data)},getIdFromXY:function(a,b){var c=this._imageData;if(c){var d=4*((0|b)*Z+(0|a)),e=c[d]|c[d+1]<<8|c[d+2]<<16;return this._idMapping[e]}},idToColor:function(a){var b=this._idMapping.indexOf(a);b===-1&&(this._idMapping.push(a),b=this._idMapping.length-1);var c=255&b,d=b>>8&255,e=b>>16&255;return"rgb("+[c,d,e].join(",")+")"}},va=function(a){this.offset={x:0,y:0},qa.init(),a&&a.addLayer(this)},wa=va.prototype=L.Layer?new L.Layer:{};wa.addTo=function(a){return a.addLayer(this),this},wa.onAdd=function(a){this.map=a,qa.appendTo(a._panes.overlayPane);var b=this.getOffset(),c=a.getPixelOrigin();o({width:a._size.x,height:a._size.y}),m({x:c.x-b.x,y:c.y-b.y}),p(a._zoom),qa.setPosition(-b.x,-b.y),a.on({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd,resize:this.onResize,viewreset:this.onViewReset,click:this.onClick},this),a.options.zoomAnimation&&a.on("zoomanim",this.onZoom,this),a.attributionControl&&a.attributionControl.addAttribution(S),ma.update()},wa.onRemove=function(){var a=this.map;a.attributionControl&&a.attributionControl.removeAttribution(S),a.off({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd,resize:this.onResize,viewreset:this.onViewReset,click:this.onClick},this),a.options.zoomAnimation&&a.off("zoomanim",this.onZoom,this),qa.remove(),a=null},wa.onMove=function(a){var b=this.getOffset();n(this.offset.x-b.x,this.offset.y-b.y)},wa.onMoveEnd=function(a){if(this.noMoveEnd)return void(this.noMoveEnd=!1);var b=this.map,c=this.getOffset(),d=b.getPixelOrigin();this.offset=c,qa.setPosition(-c.x,-c.y),n(0,0),o({width:b._size.x,height:b._size.y}),m({x:d.x-c.x,y:d.y-c.y}),q(a)},wa.onZoomStart=function(a){r(a)},wa.onZoom=function(a){var b=this.map.latLngToContainerPoint(a.center),c=Math.pow(2,a.zoom-H),d=Z/2-b.x,e=$/2-b.y,f=Z/2,g=$/2;a.zoom>H?(f-=d*c,g-=e*c):(f+=d,g+=e),qa.container.classList.add("zoom-animation"),qa.container.style.transformOrigin=f+"px "+g+"px",qa.container.style.transform="translate3d(0, 0, 0) scale("+c+")"},wa.onZoomEnd=function(a){qa.clear(),qa.container.classList.remove("zoom-animation"),qa.container.style.transform="translate3d(0, 0, 0) scale(1)";var b=this.map,c=this.getOffset(),d=b.getPixelOrigin();m({x:d.x-c.x,y:d.y-c.y}),s({zoom:b._zoom}),this.noMoveEnd=!0},wa.onResize=function(){},wa.onViewReset=function(){var a=this.getOffset();this.offset=a,qa.setPosition(-a.x,-a.y),n(0,0)},wa.onClick=function(a){var b=ua.getIdFromXY(a.containerPoint.x,a.containerPoint.y);b&&ya({feature:b,lat:a.latlng.lat,lon:a.latlng.lng})},wa.getOffset=function(){return L.DomUtil.getPosition(this.map._mapPane)},wa.style=function(a){a=a||{};var b;return(b=a.color||a.wallColor)&&(da=G.parse(b),ga=""+da,ea=da.lightness(.8),ha=""+ea,fa=da.lightness(1.2),ia=""+fa),a.roofColor&&(fa=G.parse(a.roofColor),ia=""+fa),qa.render(),this},wa.date=function(a){return ta.date=a,ta.render(),this},wa.load=function(a){return ma.load(a),this},wa.set=function(a){return ma.set(a),this};var xa=function(){};wa.each=function(a){return xa=function(b){return a(b)},this};var ya=function(){};wa.click=function(a){return ya=function(b){return a(b)},this},va.VERSION=R,va.ATTRIBUTION=S,a.OSMBuildings=va}(this);